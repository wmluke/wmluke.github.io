!function(){"use strict";function a(a,b,c,d,e){function f(a,b){e.warn("Failed to find data-block="+a+" in "+b)}return{compile:function(g,h){var i=h.extendTemplate;if(!i)throw"Template not specified in extend-template directive";var j=g.clone();g.html("");var k=c.get(i,{cache:a}).then(function(a){function b(a,b,c){var e=b.attr(c);0===d.find('[data-block="'+e+'"]')[a](b).length&&0===d.find("[data-extend-template]").append(b).length&&f(e,i)}var c=a.data,d=$(document.createElement("div")).html(c);return j.children("[data-block]").each(function(){b("replaceWith",$(this),"data-block")}),j.children("[data-block-prepend]").each(function(){b("prepend",$(this),"data-block-prepend")}),j.children("[data-block-append]").each(function(){b("append",$(this),"data-block-append")}),j.children("[data-block-before]").each(function(){b("before",$(this),"data-block-before")}),j.children("[data-block-after]").each(function(){b("after",$(this),"data-block-after")}),d},function(){var a="Failed to load template: "+i;return e.error(a),d.reject(a)});return function(a,c){k.then(function(d){c.html(d.html()),b(c.contents())(a)})}}}}angular.module("angular-blocks",[]).directive("extendTemplate",["$templateCache","$compile","$http","$q","$log",a])}(),function(){"use strict";var a=0,b=function(c){function d(a,b){angular.forEach(j.subscribers,function(c){var d=!c.type||c.type===a,e=!j.id&&!c.id||c.id===j.id;d&&e&&c.cb(b,a)})}var e,f,g,h,i,j=angular.extend({id:null,subscribers:{},classnames:{error:[],warn:[],info:[],success:[]}},c),k=this;this.clean=function(){e=null,f=null,g=null,h=null,i=null},this.subscribe=function(b,c,d){return a+=1,j.subscribers[a]={cb:b,type:c,id:d},a},this.unsubscribe=function(a){delete j.subscribers[a]},this.to=function(a){var c=angular.copy(j);return c.id=a,new b(c)},Object.defineProperty(this,"success",{get:function(){return e},set:function(a){e=a,i="success",d(i,a)}}),Object.defineProperty(this,"info",{get:function(){return f},set:function(a){f=a,i="info",d(i,a)}}),Object.defineProperty(this,"warn",{get:function(){return g},set:function(a){g=a,i="warn",d(i,a)}}),Object.defineProperty(this,"error",{get:function(){return h},set:function(a){h=a,i="error",d(i,a)}}),Object.defineProperty(this,"type",{get:function(){return i}}),Object.defineProperty(this,"message",{get:function(){return i?k[i]:null}}),Object.defineProperty(this,"classnames",{get:function(){return j.classnames}}),Object.defineProperty(this,"id",{get:function(){return j.id}})};angular.module("angular-flash.service",[]).provider("flash",function(){var a=this;this.errorClassnames=["alert-error"],this.warnClassnames=["alert-warn"],this.infoClassnames=["alert-info"],this.successClassnames=["alert-success"],this.$get=function(){return new b({classnames:{error:a.errorClassnames,warn:a.warnClassnames,info:a.infoClassnames,success:a.successClassnames}})}})}(),function(){"use strict";function a(a){return(null===a||void 0===a)&&(a=""),/^\s*$/.test(a)}function b(b,c){return{scope:!0,link:function(d,e,f){function g(){var a=[].concat(b.classnames.error,b.classnames.warn,b.classnames.info,b.classnames.success);angular.forEach(a,function(a){e.removeClass(a)})}function h(h,j){i&&c.cancel(i),d.flash.type=j,d.flash.message=h,g(),angular.forEach(b.classnames[j],function(a){e.addClass(a)}),a(f.activeClass)||e.addClass(f.activeClass);var k=Number(f.duration||5e3);k>0&&(i=c(d.hide,k))}var i,j;d.flash={},d.hide=function(){d.flash={},g(),a(f.activeClass)||e.removeClass(f.activeClass)},d.$on("$destroy",function(){b.clean(),b.unsubscribe(j)}),j=b.subscribe(h,f.flashAlert,f.id),f.flashAlert&&b[f.flashAlert]&&h(b[f.flashAlert],f.flashAlert),!f.flashAlert&&b.message&&h(b.message,b.type)}}}angular.module("angular-flash.flash-alert-directive",["angular-flash.service"]).directive("flashAlert",["flash","$timeout",b])}(),function(){"use strict";angular.module("angular-environment",[]).provider("environment",function(){var a={};this.put=function(b,c){return a[b]=c,this},this.get=function(b){return a[b]},this.$get=function(){return a}})}(),function(){"use strict";var a=function(b,c,d,e){function f(a){return angular.extend(h.httpConfig,a)}function g(a){return angular.forEach(h.responseInterceptors,function(b){a=b(a)}),a}var h=angular.extend({idField:"id",responseInterceptors:[],httpConfig:{},verbs:{}},e),i=this;Object.defineProperty(this,"rootUrl",{get:function(){return d}}),Object.defineProperty(this,"options",{get:function(){return h}}),angular.forEach(h.verbs,function(a,c){i[c]=function(){var c=f(a.apply(i,arguments));return c.url=d+c.url,g(b(c))}}),this.save=function(a,b){return a[h.idField]?i.update(a,f(b)):i.create(a,f(b))},this.clone=function(e){return new a(b,c,d,angular.extend(h,e))}};angular.module("angular-restsource",[]).config(["$provide",function(b){b.provider("restsource",function(){var c=this,d={idField:"id",httpConfig:{},verbs:{},responseInterceptors:[]},e=!0,f={page:1,perPage:25};this.idField=function(a){return d.idField=a,c},this.httpConfig=function(a){return d.httpConfig=a,c},this.defaultListLimits=function(a,b){return f={page:a,perPage:b},c},this.useBodyResponseInterceptor=function(a){return e=a,c},this.addResponseInterceptor=function(a){return d.responseInterceptors.push(a),c},this.provide=function(a,c){return b.provider(a,function(){var a=this,b=angular.copy(d),g=angular.copy(e),h=angular.copy(f);this.idField=function(c){return b.idField=c,a},this.httpConfig=function(c){return b.httpConfig=c,a},this.defaultListLimits=function(b,c){return h={page:b,perPage:c},a},this.useBodyResponseInterceptor=function(b){return g=b,a},this.addResponseInterceptor=function(c){return b.responseInterceptors.push(c),a},this.verb=function(c,d){return b.verbs[c]=d,a},this.verb("create",function(a,b){return angular.extend(b||{},{method:"POST",url:"",data:a})}),this.verb("read",function(a,b){return angular.extend(b||{},{method:"GET",url:"/"+a})}),this.verb("update",function(a,c){return angular.extend(c||{},{method:"PUT",url:"/"+a[b.idField],data:a})}),this.verb("list",function(a,b,c){return angular.extend(c||{},{method:"GET",url:"",params:{page:a||h.page,perPage:b||h.perPage}})}),this.verb("delete",function(a,b){return angular.extend(b||{},{method:"DELETE",url:"/"+a})}),this.$get=function(a,d){g&&b.responseInterceptors.unshift("bodyResponseInterceptor");var e=[];return angular.forEach(b.responseInterceptors,function(b){e.push(angular.isString(b)?a.get(b):a.invoke(b))}),b.responseInterceptors=e,d(c,b)},this.$get.$inject=["$injector","restsource"]})},this.$get=function(b,c){return function(d,e){return new a(b,c,d,e)}},this.$get.$inject=["$http","$q"]}),b.factory("bodyResponseInterceptor",["$q",function(a){return function(b){var c=b.then(function(b){var c=b.data||{};return c.error||void 0===c.body?a.reject(b):c.body});return c.success=function(a){return b.then(function(b){var c=b.data||{};a(c.body,b.status,b.headers,b.config)}),c},c.error=function(a){return b.then(null,function(b){var c=b.data||{};a(c.error||{},b.status,b.headers,b.config)}),c},c}}])}])}(),function(){"use strict";angular.module("blog-environment",["angular-environment"]).config(["environmentProvider",function(a){a.put("appUrl","http://localhost:9000"),a.put("apiUrl","http://peaceful-retreat-6264.herokuapp.com/service"),a.put("mediaUrl","http://peaceful-retreat-6264.herokuapp.com")}])}(),angular.module("clientappBlogApp",["ngRoute","ngSanitize","ngAnimate","angular-blocks","angular-flash.service","angular-flash.flash-alert-directive","angular-restsource","blog-environment"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/thoughts/stream/:stream",{templateUrl:"/views/main.html",controller:"MainCtrl"}).when("/thoughts/:name",{templateUrl:"/views/main.html",controller:"MainCtrl"}).otherwise({templateUrl:"/views/main.html",controller:"MainCtrl"}),b.hashPrefix("!")}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.common={"Content-Type":"application/json"},a.defaults.headers.delete={"Content-Type":"application/json"}}]).config(["$parseProvider",function(a){a.unwrapPromises(!0)}]).config(["restsourceProvider","environmentProvider",function(a,b){var c=b.get("apiUrl"),d={withCredentials:!0};a.defaultListLimits(null,null).httpConfig(d).useBodyResponseInterceptor(!1),a.provide("thoughtRestsource",c+"/thought").verb("findByStream",function(a,b,c,d){return angular.extend(d||{},{method:"GET",url:"/stream/"+a,params:{page:b,perPage:c}})}).verb("delta",function(a){return angular.extend(a||{},{method:"GET",url:"/delta/cursor"})}).addResponseInterceptor([function(){return function(a){var b=a.then(function(a){return a.data});return b.success=function(c){return a.then(function(a){var b=a.data||{};c(b.body,a.status,a.headers,a.config)}),b},b.error=function(c){return a.then(null,function(a){var b=a.data||{};c(b.error||{},a.status,a.headers,a.config)}),b},b}}])}]).value("_gaq",window._gaq||[]).value("appStart",new Date).run(["$rootScope","environment",function(a,b){a.env=b}]),function(){"use strict";angular.module("clientappBlogApp").controller("MainCtrl",["$scope","thoughtRestsource","$routeParams","$timeout","$location","appStart","$log","$window",function(a,b,c,d,e,f,g,h){a.thoughtsPerPage=25,a.thoughts=[],a.deltaCursor=0,a.fetchThought=function(c){a.thoughts=b.read(c).then(function(a){return[a]})},a.fetchThoughts=function(c,e){var f=c?b.findByStream(c,e,a.thoughtsPerPage):b.list(e,a.thoughtsPerPage);a.thoughts=f.then(function(a){var b=[];return angular.forEach(a,function(a,c){d(function(){b.push(a)},200*c)}),b})},a.fetch=function(){c.stream?(a.thoughtStream=c.stream,a.fetchThoughts(c.stream,1),g.info("fetching stream of thoughts: "+c.stream)):c.name?(a.fetchThought(c.name),a.thoughtName=c.name,g.info("fetching thought: "+c.name)):(a.fetchThoughts(null,1),g.info("fetching all thoughts"))},a.$watch("deltaCursor",function(b){a.fetch(),g.info("cursor: "+b)}),a.delta=function(){b.delta().success(function(b){a.deltaCursor=b})},a.published=function(a){return a.publishedDate||a.modifiedDate},a.$on("$routeChangeSuccess",function(){h._gaq&&h._gaq.push(["_trackPageview",e.path()]),h._gauges&&h._gauges.push(["track"]),h.mixpanel&&h.mixpanel.track("location",{title:e.path()})}),a.$on("$destroy",function(){a.timeoutPromise&&(d.cancel(a.timeoutPromise),g.info("cancelled timeout"))}),a.delta()}])}(),function(){"use strict";function a(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}angular.module("clientappBlogApp").directive("compile",["$compile",a])}(),function(){"use strict";function a(){return{restrict:"E",compile:function(a){var b=a.clone();return a.html(""),function(a,c){c.html(b);var d=c.find("code");d.length>0&&hljs.highlightBlock(d[0])}}}}angular.module("clientappBlogApp").directive("pre",[a])}(),function(){"use strict";function a(a){return{link:function(b,c){c.on("click",".btn-select-thought",function(){c.hasClass("rotated")?(c.css("height",c.find(".thought-page").height()+"px"),a(function(){c.toggleClass("rotated"),$("html, body").animate({scrollTop:c.offset().top-10})},500)):(c.toggleClass("rotated"),a(function(){c.css("height","225px")},500))})}}}angular.module("clientappBlogApp").directive("rotate",["$timeout",a])}();