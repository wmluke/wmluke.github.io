!function(a,b){"use strict";function c(){function a(a,c){return b.extend(new(b.extend(function(){},{prototype:a})),c)}function c(a,b){var c=b.caseInsensitiveMatch,d={originalPath:a,regexp:a},e=d.keys=[];return a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?|\*])?/g,function(a,b,c,d){var f="?"===d?d:null,g="*"===d?d:null;return e.push({name:c,optional:!!f}),b=b||"",""+(f?"":b)+"(?:"+(f?b:"")+(g&&"(.+?)"||"([^/]+)")+(f||"")+")"+(f||"")}).replace(/([\/$\*])/g,"\\$1"),d.regexp=new RegExp("^"+a+"$",c?"i":""),d}var d={};this.when=function(a,e){if(d[a]=b.extend({reloadOnSearch:!0},e,a&&c(a,e)),a){var f="/"==a[a.length-1]?a.substr(0,a.length-1):a+"/";d[f]=b.extend({redirectTo:a},c(f,e))}return this},this.otherwise=function(a){return this.when(null,a),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(c,e,f,g,h,i,j,k){function l(a,b){var c=b.keys,d={};if(!b.regexp)return null;var e=b.regexp.exec(a);if(!e)return null;for(var f=1,g=e.length;g>f;++f){var h=c[f-1],i="string"==typeof e[f]?decodeURIComponent(e[f]):e[f];h&&i&&(d[h.name]=i)}return d}function m(){var a=n(),d=q.current;a&&d&&a.$$route===d.$$route&&b.equals(a.pathParams,d.pathParams)&&!a.reloadOnSearch&&!p?(d.params=a.params,b.copy(d.params,f),c.$broadcast("$routeUpdate",d)):(a||d)&&(p=!1,c.$broadcast("$routeChangeStart",a,d),q.current=a,a&&a.redirectTo&&(b.isString(a.redirectTo)?e.path(o(a.redirectTo,a.params)).search(a.params).replace():e.url(a.redirectTo(a.pathParams,e.path(),e.search())).replace()),g.when(a).then(function(){if(a){var c,d,e=b.extend({},a.resolve);return b.forEach(e,function(a,c){e[c]=b.isString(a)?h.get(a):h.invoke(a)}),b.isDefined(c=a.template)?b.isFunction(c)&&(c=c(a.params)):b.isDefined(d=a.templateUrl)&&(b.isFunction(d)&&(d=d(a.params)),d=k.getTrustedResourceUrl(d),b.isDefined(d)&&(a.loadedTemplateUrl=d,c=i.get(d,{cache:j}).then(function(a){return a.data}))),b.isDefined(c)&&(e.$template=c),g.all(e)}}).then(function(e){a==q.current&&(a&&(a.locals=e,b.copy(a.params,f)),c.$broadcast("$routeChangeSuccess",a,d))},function(b){a==q.current&&c.$broadcast("$routeChangeError",a,d,b)}))}function n(){var c,f;return b.forEach(d,function(d){!f&&(c=l(e.path(),d))&&(f=a(d,{params:b.extend({},e.search(),c),pathParams:c}),f.$$route=d)}),f||d[null]&&a(d[null],{params:{},pathParams:{}})}function o(a,c){var d=[];return b.forEach((a||"").split(":"),function(a,b){if(0===b)d.push(a);else{var e=a.match(/(\w+)(.*)/),f=e[1];d.push(c[f]),d.push(e[2]||""),delete c[f]}}),d.join("")}var p=!1,q={routes:d,reload:function(){p=!0,c.$evalAsync(m)}};return c.$on("$locationChangeSuccess",m),q}]}function d(){this.$get=function(){return{}}}function e(a,b,c,d,e){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(f,g,h){return function(f,g,i){function j(){l&&(l.$destroy(),l=null),m&&(e.leave(m),m=null)}function k(){var i=a.current&&a.current.locals,k=i&&i.$template;if(k){var o=f.$new();h(o,function(f){j(),f.html(k),e.enter(f,null,g);var h=c(f.contents()),p=a.current;if(l=p.scope=o,m=f,p.controller){i.$scope=l;var q=d(p.controller,i);p.controllerAs&&(l[p.controllerAs]=q),f.data("$ngControllerController",q),f.children().data("$ngControllerController",q)}h(l),l.$emit("$viewContentLoaded"),l.$eval(n),b()})}else j()}var l,m,n=i.onload||"";f.$on("$routeChangeSuccess",k),k()}}}}var f=b.module("ngRoute",["ng"]).provider("$route",c);f.provider("$routeParams",d),f.directive("ngView",e),e.$inject=["$route","$anchorScroll","$compile","$controller","$animate"]}(window,window.angular),function(a,b){"use strict";function c(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function d(a,c){function d(a,d,g,h){if(d=b.lowercase(d),x[d])for(;s.last()&&y[s.last()];)f("",s.last());w[d]&&s.last()==d&&f("",d),h=t[d]||!!h,h||s.push(d);var i={};g.replace(l,function(a,b,c,d,f){var g=c||d||f||"";i[b]=e(g)}),c.start&&c.start(d,i,h)}function f(a,d){var e,f=0;if(d=b.lowercase(d))for(f=s.length-1;f>=0&&s[f]!=d;f--);if(f>=0){for(e=s.length-1;e>=f;e--)c.end&&c.end(s[e]);s.length=f}}var g,i,r,s=[],u=a;for(s.last=function(){return s[s.length-1]};a;){if(i=!0,s.last()&&z[s.last()])a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+s.last()+"[^>]*>","i"),function(a,b){return b=b.replace(o,"$1").replace(q,"$1"),c.chars&&c.chars(e(b)),""}),f("",s.last());else if(0===a.indexOf("<!--")?(g=a.indexOf("--",4),g>=0&&a.lastIndexOf("-->",g)===g&&(c.comment&&c.comment(a.substring(4,g)),a=a.substring(g+3),i=!1)):p.test(a)?(r=a.match(p),r&&(a=a.replace(r[0],""),i=!1)):n.test(a)?(r=a.match(k),r&&(a=a.substring(r[0].length),r[0].replace(k,f),i=!1)):m.test(a)&&(r=a.match(j),r&&(a=a.substring(r[0].length),r[0].replace(j,d),i=!1)),i){g=a.indexOf("<");var v=0>g?a:a.substring(0,g);a=0>g?"":a.substring(g),c.chars&&c.chars(e(v))}if(a==u)throw h("badparse","The sanitizer was unable to parse the following block of html: {0}",a);u=a}f()}function e(a){return D.innerHTML=a.replace(/</g,"&lt;"),D.innerText||D.textContent||""}function f(a){return a.replace(/&/g,"&amp;").replace(s,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function g(a){var c=!1,d=b.bind(a,a.push);return{start:function(a,e,g){a=b.lowercase(a),!c&&z[a]&&(c=a),c||1!=A[a]||(d("<"),d(a),b.forEach(e,function(a,c){var e=b.lowercase(c);1!=C[e]||B[e]===!0&&!a.match(r)||(d(" "),d(c),d('="'),d(f(a)),d('"'))}),d(g?"/>":">"))},end:function(a){a=b.lowercase(a),c||1!=A[a]||(d("</"),d(a),d(">")),a==c&&(c=!1)},chars:function(a){c||d(f(a))}}}var h=b.$$minErr("$sanitize"),i=function(a){var b=[];return d(a,g(b)),b.join("")},j=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,k=/^<\s*\/\s*([\w:-]+)[^>]*>/,l=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,m=/^</,n=/^<\s*\//,o=/<!--(.*?)-->/g,p=/<!DOCTYPE([^>]*?)>/i,q=/<!\[CDATA\[(.*?)]]>/g,r=/^((ftp|https?):\/\/|mailto:|tel:|#)/i,s=/([^\#-~| |!])/g,t=c("area,br,col,hr,img,wbr"),u=c("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),v=c("rp,rt"),w=b.extend({},v,u),x=b.extend({},u,c("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),y=b.extend({},v,c("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),z=c("script,style"),A=b.extend({},t,x,y,w),B=c("background,cite,href,longdesc,src,usemap"),C=b.extend({},B,c("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,span,start,summary,target,title,type,valign,value,vspace,width")),D=document.createElement("pre");b.module("ngSanitize",[]).value("$sanitize",i),b.module("ngSanitize").filter("linky",function(){var a=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s\.\;\,\(\)\{\}\<\>]/,c=/^mailto:/;return function(d,e){if(!d)return d;var f,h,i,j=d,k=[],l=g(k),m={};for(b.isDefined(e)&&(m.target=e);f=j.match(a);)h=f[0],f[2]==f[3]&&(h="mailto:"+h),i=f.index,l.chars(j.substr(0,i)),m.href=h,l.start("a",m),l.chars(f[0].replace(c,"")),l.end("a"),j=j.substring(i+f[0].length);return l.chars(j),k.join("")}})}(window,window.angular),function(){"use strict";function a(a,b,c,d,e){function f(a,b){e.warn("Failed to find data-block="+a+" in "+b)}return{compile:function(g,h){var i=h.extendTemplate;if(!i)throw"Template not specified in extend-template directive";var j=g.clone();g.html("");var k=c.get(i,{cache:a}).then(function(a){function b(a,b,c){var e=b.attr(c);0===d.find('[data-block="'+e+'"]')[a](b).length&&0===d.find("[data-extend-template]").append(b).length&&f(e,i)}var c=a.data,d=$(document.createElement("div")).html(c);return j.children("[data-block]").each(function(){b("replaceWith",$(this),"data-block")}),j.children("[data-block-prepend]").each(function(){b("prepend",$(this),"data-block-prepend")}),j.children("[data-block-append]").each(function(){b("append",$(this),"data-block-append")}),j.children("[data-block-before]").each(function(){b("before",$(this),"data-block-before")}),j.children("[data-block-after]").each(function(){b("after",$(this),"data-block-after")}),d},function(){var a="Failed to load template: "+i;return e.error(a),d.reject(a)});return function(a,c){k.then(function(d){c.html(d.html()),b(c.contents())(a)})}}}}angular.module("angular-blocks",[]).directive("extendTemplate",["$templateCache","$compile","$http","$q","$log",a])}(),function(){"use strict";var a=0,b=function(c){function d(a,b){angular.forEach(j.subscribers,function(c){var d=!c.type||c.type===a,e=!j.id&&!c.id||c.id===j.id;d&&e&&c.cb(b,a)})}var e,f,g,h,i,j=angular.extend({id:null,subscribers:{},classnames:{error:[],warn:[],info:[],success:[]}},c),k=this;this.clean=function(){e=null,f=null,g=null,h=null,i=null},this.subscribe=function(b,c,d){return a+=1,j.subscribers[a]={cb:b,type:c,id:d},a},this.unsubscribe=function(a){delete j.subscribers[a]},this.to=function(a){var c=angular.copy(j);return c.id=a,new b(c)},Object.defineProperty(this,"success",{get:function(){return e},set:function(a){e=a,i="success",d(i,a)}}),Object.defineProperty(this,"info",{get:function(){return f},set:function(a){f=a,i="info",d(i,a)}}),Object.defineProperty(this,"warn",{get:function(){return g},set:function(a){g=a,i="warn",d(i,a)}}),Object.defineProperty(this,"error",{get:function(){return h},set:function(a){h=a,i="error",d(i,a)}}),Object.defineProperty(this,"type",{get:function(){return i}}),Object.defineProperty(this,"message",{get:function(){return i?k[i]:null}}),Object.defineProperty(this,"classnames",{get:function(){return j.classnames}}),Object.defineProperty(this,"id",{get:function(){return j.id}})};angular.module("angular-flash.service",[]).provider("flash",function(){var a=this;this.errorClassnames=["alert-error"],this.warnClassnames=["alert-warn"],this.infoClassnames=["alert-info"],this.successClassnames=["alert-success"],this.$get=function(){return new b({classnames:{error:a.errorClassnames,warn:a.warnClassnames,info:a.infoClassnames,success:a.successClassnames}})}})}(),function(){"use strict";function a(a){return(null===a||void 0===a)&&(a=""),/^\s*$/.test(a)}function b(b,c){return{scope:!0,link:function(d,e,f){function g(){var a=[].concat(b.classnames.error,b.classnames.warn,b.classnames.info,b.classnames.success);angular.forEach(a,function(a){e.removeClass(a)})}function h(h,j){i&&c.cancel(i),d.flash.type=j,d.flash.message=h,g(),angular.forEach(b.classnames[j],function(a){e.addClass(a)}),a(f.activeClass)||e.addClass(f.activeClass);var k=Number(f.duration||5e3);k>0&&(i=c(d.hide,k))}var i,j;d.flash={},d.hide=function(){d.flash={},g(),a(f.activeClass)||e.removeClass(f.activeClass)},d.$on("$destroy",function(){b.clean(),b.unsubscribe(j)}),j=b.subscribe(h,f.flashAlert,f.id),f.flashAlert&&b[f.flashAlert]&&h(b[f.flashAlert],f.flashAlert),!f.flashAlert&&b.message&&h(b.message,b.type)}}}angular.module("angular-flash.flash-alert-directive",["angular-flash.service"]).directive("flashAlert",["flash","$timeout",b])}(),function(){"use strict";angular.module("angular-environment",[]).provider("environment",function(){var a={};this.put=function(b,c){return a[b]=c,this},this.get=function(b){return a[b]},this.$get=function(){return a}})}(),function(){"use strict";var a=function(b,c,d,e){function f(a){return angular.extend(h.httpConfig,a)}function g(a){return angular.forEach(h.responseInterceptors,function(b){a=b(a)}),a}var h=angular.extend({idField:"id",responseInterceptors:[],httpConfig:{},verbs:{}},e),i=this;Object.defineProperty(this,"rootUrl",{get:function(){return d}}),Object.defineProperty(this,"options",{get:function(){return h}}),angular.forEach(h.verbs,function(a,c){i[c]=function(){var c=f(a.apply(i,arguments));return c.url=d+c.url,g(b(c))}}),this.save=function(a,b){return a[h.idField]?i.update(a,f(b)):i.create(a,f(b))},this.clone=function(e){return new a(b,c,d,angular.extend(h,e))}};angular.module("angular-restsource",[]).config(["$provide",function(b){b.provider("restsource",function(){var c=this,d={idField:"id",httpConfig:{},verbs:{},responseInterceptors:[]},e=!0,f={page:1,perPage:25};this.idField=function(a){return d.idField=a,c},this.httpConfig=function(a){return d.httpConfig=a,c},this.defaultListLimits=function(a,b){return f={page:a,perPage:b},c},this.useBodyResponseInterceptor=function(a){return e=a,c},this.addResponseInterceptor=function(a){return d.responseInterceptors.push(a),c},this.provide=function(a,c){return b.provider(a,function(){var a=this,b=angular.copy(d),g=angular.copy(e),h=angular.copy(f);this.idField=function(c){return b.idField=c,a},this.httpConfig=function(c){return b.httpConfig=c,a},this.defaultListLimits=function(b,c){return h={page:b,perPage:c},a},this.useBodyResponseInterceptor=function(b){return g=b,a},this.addResponseInterceptor=function(c){return b.responseInterceptors.push(c),a},this.verb=function(c,d){return b.verbs[c]=d,a},this.verb("create",function(a,b){return angular.extend(b||{},{method:"POST",url:"",data:a})}),this.verb("read",function(a,b){return angular.extend(b||{},{method:"GET",url:"/"+a})}),this.verb("update",function(a,c){return angular.extend(c||{},{method:"PUT",url:"/"+a[b.idField],data:a})}),this.verb("list",function(a,b,c){return angular.extend(c||{},{method:"GET",url:"",params:{page:a||h.page,perPage:b||h.perPage}})}),this.verb("delete",function(a,b){return angular.extend(b||{},{method:"DELETE",url:"/"+a})}),this.$get=function(a,d){g&&b.responseInterceptors.unshift("bodyResponseInterceptor");var e=[];return angular.forEach(b.responseInterceptors,function(b){e.push(angular.isString(b)?a.get(b):a.invoke(b))}),b.responseInterceptors=e,d(c,b)},this.$get.$inject=["$injector","restsource"]})},this.$get=function(b,c){return function(d,e){return new a(b,c,d,e)}},this.$get.$inject=["$http","$q"]}),b.factory("bodyResponseInterceptor",["$q",function(a){return function(b){var c=b.then(function(b){var c=b.data||{};return c.error||void 0===c.body?a.reject(b):c.body});return c.success=function(a){return b.then(function(b){var c=b.data||{};a(c.body,b.status,b.headers,b.config)}),c},c.error=function(a){return b.then(null,function(b){var c=b.data||{};a(c.error||{},b.status,b.headers,b.config)}),c},c}}])}])}(),function(){"use strict";angular.module("blog-environment",["angular-environment"]).config(["environmentProvider",function(a){a.put("appUrl","http://localhost:9000"),a.put("apiUrl","http://peaceful-retreat-6264.herokuapp.com/service"),a.put("mediaUrl","http://peaceful-retreat-6264.herokuapp.com")}])}(),angular.module("clientappBlogApp",["ngRoute","ngSanitize","angular-blocks","angular-flash.service","angular-flash.flash-alert-directive","angular-restsource","blog-environment"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/thoughts/stream/:stream",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/thoughts/:name",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({templateUrl:"views/main.html",controller:"MainCtrl"}),b.hashPrefix("!")}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.common={"Content-Type":"application/json"},a.defaults.headers.delete={"Content-Type":"application/json"}}]).config(["$parseProvider",function(a){a.unwrapPromises(!0)}]).config(["restsourceProvider","environmentProvider",function(a,b){var c=b.get("apiUrl"),d={withCredentials:!0};a.defaultListLimits(null,null).httpConfig(d).useBodyResponseInterceptor(!1),a.provide("thoughtRestsource",c+"/thought").verb("findByStream",function(a,b,c,d){return angular.extend(d||{},{method:"GET",url:"/stream/"+a,params:{page:b,perPage:c}})}).verb("delta",function(a){return angular.extend(a||{},{method:"GET",url:"/delta/cursor"})})}]).value("_gaq",window._gaq||[]).value("appStart",new Date),function(){"use strict";angular.module("clientappBlogApp").controller("MainCtrl",["$scope","thoughtRestsource","$routeParams","$timeout","_gaq","$location","appStart","$log",function(a,b,c,d,e,f,g,h){function i(b){a.thoughts=b}function j(){}function k(a,b){return(a-b)/1e3}function l(a){return a>600?null:a>180?60:30}a.thoughtsPerPage=25,a.thoughts=[],a.deltaCursor=0,a.fetchThought=function(c){b.read(c).success(function(b){a.thoughts=[b]}).error(j)},a.fetchThoughts=function(c,d){c?b.findByStream(c,d,a.thoughtsPerPage).success(i).error(j):b.list(d,a.thoughtsPerPage).success(i).error(j)},a.fetch=function(){c.stream?(a.fetchThoughts(c.stream,1),h.info("fetching stream of thoughts: "+c.stream)):c.name?(a.fetchThought(c.name),h.info("fetching thought: "+c.name)):(a.fetchThoughts(null,1),h.info("fetching all thoughts"))},a.$watch("deltaCursor",function(b){a.fetch(),h.info("cursor: "+b)}),a.delta=function(){b.delta().success(function(b){a.deltaCursor=b})},a.published=function(a){return a.published||a.modified},a.poll=function(){a.delta();var b=new Date,c=k(b,g),e=l(c);h.info("poll "+c+" sec, next poll in "+e+" sec."),e&&(a.timeoutPromise=d(a.poll,1e3*e))},a.$on("$routeChangeSuccess",function(){e.push(["_trackPageview",f.path()])}),a.$on("$destroy",function(){a.timeoutPromise&&(d.cancel(a.timeoutPromise),h.info("cancelled timeout"))}),a.delta()}])}(),function(){"use strict";function a(a){return{restrict:"C",replace:!0,template:'<img ng-src="{{ imgUrl }}">',link:function(b,c,d){b.imgUrl=a.mediaUrl+d.src,c.addClass("img-markdown")}}}angular.module("clientappBlogApp").directive("imgMarkdown",["environment",a])}(),function(){"use strict";function a(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}angular.module("clientappBlogApp").directive("compile",["$compile",a])}();