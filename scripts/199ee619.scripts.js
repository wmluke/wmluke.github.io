!function(){"use strict";angular.module("blog-environment",["angular-environment"]).config(["environmentProvider",function(a){a.put("appUrl","http://localhost:9000"),a.put("apiUrl","http://peaceful-retreat-6264.herokuapp.com/service"),a.put("mediaUrl","http://peaceful-retreat-6264.herokuapp.com")}])}(),angular.module("clientappBlogApp",["ngRoute","ngCookies","ngSanitize","angular-blocks","angular-flash.service","angular-flash.flash-alert-directive","angular-restsource","blog-environment"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/thoughts/stream/:stream",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/thoughts/:name",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({templateUrl:"views/main.html",controller:"MainCtrl"}),b.hashPrefix("!")}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,a.defaults.headers.common={"Content-Type":"application/json"},a.defaults.headers.delete={"Content-Type":"application/json"}}]).config(["$parseProvider",function(a){a.unwrapPromises(!0)}]).config(["restsourceProvider","environmentProvider",function(a,b){var c=b.get("apiUrl"),d={withCredentials:!0};a.defaultListLimits(null,null).httpConfig(d).useBodyResponseInterceptor(!1),a.provide("thoughtRestsource",c+"/thought").verb("findByStream",function(a,b,c,d){return angular.extend(d||{},{method:"GET",url:"/stream/"+a,params:{page:b,perPage:c}})}).verb("delta",function(a){return angular.extend(a||{},{method:"GET",url:"/delta/cursor"})})}]).value("_gaq",window._gaq||[]).value("appStart",new Date),function(){"use strict";angular.module("clientappBlogApp").controller("MainCtrl",["$scope","thoughtRestsource","$routeParams","$timeout","_gaq","$location","appStart","$log",function(a,b,c,d,e,f,g,h){function i(b){a.thoughts=b}function j(){}function k(a,b){return(a-b)/1e3}function l(a){return a>600?null:a>180?60:30}a.thoughtsPerPage=25,a.thoughts=[],a.deltaCursor=0,a.fetchThought=function(c){b.read(c).success(function(b){a.thoughts=[b]}).error(j)},a.fetchThoughts=function(c,d){c?b.findByStream(c,d,a.thoughtsPerPage).success(i).error(j):b.list(d,a.thoughtsPerPage).success(i).error(j)},a.fetch=function(){c.stream?(a.fetchThoughts(c.stream,1),h.info("fetching stream of thoughts: "+c.stream)):c.name?(a.fetchThought(c.name),h.info("fetching thought: "+c.name)):(a.fetchThoughts(null,1),h.info("fetching all thoughts"))},a.$watch("deltaCursor",function(b){a.fetch(),h.info("cursor: "+b)}),a.delta=function(){b.delta().success(function(b){a.deltaCursor=b})},a.published=function(a){return a.published||a.modified},a.poll=function(){a.delta();var b=new Date,c=k(b,g),e=l(c);h.info("poll "+c+" sec, next poll in "+e+" sec."),e&&(a.timeoutPromise=d(a.poll,1e3*e))},a.$on("$routeChangeSuccess",function(){e.push(["_trackPageview",f.path()])}),a.$on("$destroy",function(){a.timeoutPromise&&(d.cancel(a.timeoutPromise),h.info("cancelled timeout"))}),a.delta()}])}(),function(){"use strict";function a(a){return{restrict:"C",replace:!0,template:'<img ng-src="{{ imgUrl }}">',link:function(b,c,d){b.imgUrl=a.mediaUrl+d.src,c.addClass("img-markdown")}}}angular.module("clientappBlogApp").directive("imgMarkdown",["environment",a])}(),function(){"use strict";function a(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}angular.module("clientappBlogApp").directive("compile",["$compile",a])}();